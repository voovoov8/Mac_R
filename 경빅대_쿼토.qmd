---
title: "ê²½ë¹…ëŒ€_ì¿¼í† "
author: "yoon"
format: html
editor: visual
---

# ì¿¼í† ì˜ ê°œìš” (heading)

ì¿¼í† ëŠ” ë°ì´í„° ì‚¬ì´ì–¸ìŠ¤ì—ì„œ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë¬¸ì„œ ì‘ì„± í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.

## ì‚¬ìš© ëª©ì 

ì‚¬ìš© ëª©ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. - ë¬¸ì„œ ê´€ë¦¬ - ì •ë³´ êµí™˜

## ë°ì´í„° ë¶„ì„

auto.csv ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ë“¤ì…ë‹ˆë‹¤.

code-chunkë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.

ggplot2ë¥¼ ì´ìš©í•´ì„œ ì‚°í¬ë„ë¥¼ ê·¸ë ¤ë³´ê² ìŠµë‹ˆë‹¤.

ê°€ë¡œì¶•ì€ mpg, ì„¸ë¡œì¶•ì€ priceë¥¼ ê·¸ë ¤ë³´ê² ìŠµë‹ˆë‹¤.

```{r}
library(dplyr)
library(ggplot2)
library(readr)
library(readxl)
theme_set(theme_grey(base_family='NanumGothic'))

```

<br> <br> <br> <br> <br> <br>

# íšŒê·€ë¶„ì„

## ols ì˜ ì´ë¡ ì  ì´í•´

$$
y_i = \beta_0 + \beta_1 x_i + e_i
$$ {#eq-regression}

$$
y_i = \beta_0 +\beta_1 x_i + e_i
$$

-   $=$ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì™¼ìª½ì— ìˆëŠ” ë³€ìˆ˜ $y$, ì¢…ì†ë³€ìˆ˜ í˜¹ì€ í”¼ì„¤ë©´ë³€ìˆ˜

-   $=$ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì˜¤ë¥¸ìª½ì— ìˆëŠ” ë³€ìˆ˜ $y$, ì¢…ì†ë³€ìˆ˜ í˜¹ì€ í”¼ì„¤ë©´ë³€ìˆ˜ $x$, ë…ë¦½ë³€ìˆ˜ í˜¹ì€ ì„¤ëª…ë³€ìˆ˜

-   $e$ ëŠ” ì˜¤ì°¨í•  , ì„¤ëª…ë˜ì§€ ì•ŠëŠ” ë¶€ë¶„

$x$ rk 1ê°œ ì´ë©´ ë‹¨ìˆœíšŒê·€, $x$ ê°€ ì—¬ëŸ¬ê°œì´ë©´ ë‹¤ì¤‘íšŒê·€

-   ì•„ë˜ ì˜¤ì°¨ì œê³±ì˜ í•©ì´ ê°€ì¥ ì‘ì•„ì§€ë„ë¡ $beta_0, \beta_1$ ì„ ì •í•œë‹¤.

$$ 
\sum_{i=1}^ {n} e_i^2
$$

-   ols ë¼ê³  í•œë‹¤. (ìœ„ì˜ ê³µì‹ì„ ì™¸ìš°ë€ë‹¤)

```{r}
```

```{r}
library(tidyverse)
setwd("/Users/yunchaeho/r_space")
ceosal<- readr::read_csv("ceosal1.csv", 
                         col_name= TRUE)
```

-   ê¸°ì—…ì˜ CEOì˜ ì—°ë´‰ì— ëŒ€í•œ ë°ì´í„°

```{r}
str(ceosal)
```

-   salary ë¥¼ ìˆ˜ìµë¥  roe ê°€ ì„¤ëª…í•  ìˆ˜ ìˆëŠ”ê°€? ë˜ëŠ” ì–¼ë§ˆë‚˜ ì„¤ëª…í•˜ëŠ”ê°€? ì™œ? ë‚˜ëŠ” roe, ì¦‰ ë§ˆì§„/ equity ê°€ ë…¸ë™ì˜ ëŒ€ê°€ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤ê³  ë³´ê¸° ë•Œë¬¸ ë‹¤ì‹œ ë§í•˜ë©´, ë²Œì–´ë“¤ì´ëŠ” ëˆì¤‘ ìˆœìˆ˜í•œ ì´ìµì´ ë…¸ë™ì˜ ëŒ€ê°€ì˜ scales ë¡œ ì‚°ì¶œë  ìˆ˜ ìˆëŠ” ê²ƒì¼ê¹Œ?

$$ 
 salary_i = a + b \times roe_i = e_i
$$

<br>

-   ê·€ë¬´ê°€ì„¤ null hupothesis $H_0$ <br> $$ 
    H_0 : b = 0 
    $$

<br>

## ê·¸ë¦¼ ê·¸ë ¤ë³´ê¸°

-   Roe ê°€ ê°€ë¡œì¶•, salaryê°€ ì„¸ë¡œì¶•ì¸ ì‚°í¬ë„

```{r}
ggplot(ceosal, mapping = aes(x=roe, y = sales )) +
  geom_point() + 
  labs(title = "ROE ì™€ salary")
```

```{r}
library(RColorBrewer)
display.brewer.all()
```

<br> - Roe ê°€ ê°€ë¡œì¶•, salaryê°€ ì„¸ë¡œì¶•ì¸ ì‚°í¬ë„ indus ë³„ë¡œ ë‹¤ë¥¸ìƒ‰

```{r}
ggplot(ceosal, mapping = aes(x=roe, y = sales, color = as.factor(indus))) +
  geom_point() + 
  labs(title = "ROE ì™€ salary") + 
  theme_minimal(base_family='NanumGothic') +
  scale_color_brewer(palette =  "Blues")
```

-   as.factorë¥¼ í™œìš©í•´ì„œ 1ë˜ëŠ” 0ì˜ ë³€ìˆ˜ë¡œ ì¸ì§€ì‹œí‚¨ë‹¤.

<br>

```{r}
ggplot(ceosal, mapping = aes( x = roe, y = salary )) +
  geom_point() +
  geom_smooth(method = "lm",
              se =TRUE)+ 
  labs( title = "ì‚°í¬ë„ì™€ lfit")
```

<br> - ëª¨í˜•ì˜ ê³„ìˆ˜ $a, b$ ë¥¼ OLSë¡œ ì¶”ì •í•œë‹¤

```{r}
lm.roe <- lm(salary ~roe, data = ceosal)
summary(lm.roe)
```

<br>

"roeê°€ 1 ë“¤ì–´ë‚¬ì„ë•Œ, ì…€ëŸ¬ë¦¬ê°€ 18.5 ëŠ˜ì–´ë‚œë‹¤."ê³  í•´ì„í•œë‹¤. aëŠ” roe = 10 , bëŠ” roe = 11 ì´ë¼ê³  í–ˆì„ë•Œ ìš°ë¦° ì´ê±¸ ë³´ê³  bê°€ aë³´ë‹¤ salary ê°€ 18.5 ë§Œí¼ ë” í¬ê² êµ¬ë‚˜ í•˜ê³  í•´ì„í•œë‹¤ëŠ” ê²ƒ.

roeê°€ salary ë¥¼ ì˜ ì„¤ëª… ëª»í•˜ëŠ”ë°( ìœ ì˜ìˆ˜ì¤€ ) ë”°ë¼ì„œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•  ìˆ˜ê°€ ì—†ìŒ.

```{r}
#install.packages("stargazer")
```

-   íšŒê·€ë¶„ì„ ê²°ê³¼ í†µê³„ì— ëŒ€í•œ ê³ í’ˆì§ˆ íŒ¨í‚¤ì§€ "stargazer"

```{r}
library(stargazer)
```

```{r}
stargazer(lm.roe, 
          type ="text",
          keep.stat = c("n", "rsq"))
```

-   1ì¢… ì˜¤ë¥˜(false positive) : 0ì¸ë° 0ì´ ì•„ë‹ˆë¼ê³  í•˜ëŠ” ì˜¤ë¥˜
-   ìœ ì˜ìˆ˜ì¤€ 5%, ê¸°ê°ì—­ 2 (1.96), ì‹ ë¢°ìˆ˜ì¤€ 95%

# 11/13 ê°•ì˜ë‚´ìš©

-   roeì™€ ì„ê¸ˆì˜ ê´€ê³„ë¡œ ëŒì•„ì™€ì„œ

-   roe ëŒ€ì‹ ì— ë‹¤ë¥¸ ì„¤ëª…ë³€ìˆ˜, ì˜ˆë¥¼ ë“¤ì–´ì„œ sales, ë§¤ì¶œì•¡

-   sales í•˜ê³  roe ì™€ì˜ ìƒê´€ê´€ê³„

```{r}
print(cor(ceosal$sales, ceosal$salary))

```

## ê·¸ë¦¼ ê·¸ë ¤ë³´ê¸°

```{r}
ggplot(ceosal, mapping = aes(x = sales, y = salary)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue")
```

-   sales ëŠ” \<25000 ì´ê³  salary \<5000ì¸ ê¸°ì—…ë§Œ ëŒ€ìƒìœ¼ë¡œ ê·¸ë ¤ë³´ì geom_rug()

```{r}
ggplot(ceosal, mapping = aes(x = sales, y = salary)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  xlim(0, 25000) + 
  ylim(0, 5000)
```

-   ì´ ë°©ì‹ë„ ìˆë‹¤.

```{r}
print("ë¡œê·¸ë¥¼ ì·¨í•œ ë¶„í¬ë¥¼ í™•ì¸í•˜ëŠ” ê²½ìš°")
ceosal |>  
  filter(sales < 25000 & salary < 5000) |>  
  mutate(log_sales = log(sales), log_salary = log(salary)) |>  
  ggplot(mapping = aes(x = log_sales, y = log_salary)) +  
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  geom_rug() 

```

-   íšŒê·€ëª¨í˜•ì„ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¾¼ë‹¤ $$
    \log(salary_i) =  a + b\log(sales_i) + e_i 
    $$

{r}
str(ceosal)

```{r}
lm.sales <- lm(lsalary ~ lsales, data = ceosal)
stargazer( lm.sales,
           type = "text",
           keep.stat = c("n", "rsq"))
```

-   ì´ê±¸ í•´ì„í•˜ëŠ” ë°©ì‹ì´ ì¤‘ìš”í•˜ê² ë‹¤ yì˜ xì— ëŒ€í•œ íƒ„ë ¥ì„±ì´ë‹¤. ì¦‰ xê°€ 1% ë³€í–ˆì„ë•Œ yê°€ ëª‡í”„ë¡œ ë³€í•˜ëŠëƒë¥¼ ì¸¡ì •í•˜ëŠ” ë°©ì‹

ì—¬ê¸°ê¹Œì§€ê°€ $x$ ê°€ í•˜ë‚˜ì¸ simple regression

```{r}
rm(list = ls())
gpa<- read.csv("/Users/yunchaeho/r_space/gpa1.csv",
                header = TRUE,
                sep = "\t")
attach(gpa)
str(gpa)
```

```{r}
library(ggplot2)
```

-   hsgpa colgpa ì˜ ìƒê´€ê´€ê³„ë¥¼ ì‚°í¬ë„ë¡œ ê·¸ë¦¬ë˜ male ì— ë”°ë¼ì„œ ë‹¤ë¥¸ìƒ‰ìœ¼ë¡œ

```{r}
ggplot(gpa, mapping = aes(x = hsGPA , colGPA, color= as.factor(male))) +
  geom_point()
```

ì ìœ„ì™€ ê°™ì€ ë°©ë²•ì—ì„œëŠ” íŠ¹ì • ì ì— ì—¬ëŸ¬ê°œ ì°ì—ˆì„ë•Œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ë‹¤ í•´ê²°ë²• 1. ìƒ‰ì•„ì£¼ ì—°í•˜ê²Œ í•´ì„œ ê²¹ì¹˜ë©´ ì°í•˜ê²Œ ë˜ëŠ” ë°©ì‹ 2. jitter

```{r}
ggplot(gpa, mapping = aes(x = hsGPA , colGPA, color= as.factor(male))) +
  geom_point() + 
  geom_smooth(method = "lm")
  geom_jitter(width = 0.2)
```

```{r}
ggplot(gpa, mapping = aes(x = hsGPA, y = colGPA, color = as.factor(male))) +  
  geom_point() + 
  geom_jitter(width = 0.2) +  
  geom_smooth(method = "lm", aes(group = 1), se = FALSE)  
```

aesë¡œ ê·¸ë£¹ì„ í•˜ë‚˜ë¡œ ë¬¶ì–´ë²„ë¦¬ëŠ” ì¼€ì´ìŠ¤ì¸ë°,

```{r}
ggplot(gpa, mapping = aes(x = hsGPA, y = colGPA, color = as.factor(male), group = 1)) +  
  geom_point() + 
  geom_jitter(width = 0.2) +  
  geom_smooth(method = "lm")  
```

# 11/20ì¼ ìˆ˜ì—…

-   íšŒê·€ë¶„ì„ì„ í•˜ê³  ìˆë‹¤.
-   xê°€ yë¥¼ ì–¼ë§ˆë‚˜ ì˜ ì„¤ëª…í•˜ê³  ìˆëŠ”ì§€ ì•Œê³  ì‹¶ë‹¤ë©´, xì´ì™¸ì˜ ë³€ìˆ˜ë“¤ì€ ëª¨ë‘ ë§ì¶”ëŠ” ì‘ì—…ì´ í•„ìš”í•¨. -\> ì¦‰ ì´ê±¸ "í†µì œ" ë¼ê³  í•˜ëŠ”ë°, íšŒê·€ì‹ì— ì§‘ì–´ ë„£ëŠ” ê²ƒì´ ê·¸ê²ƒì´ë‹¤.

$$
y_i = \beta_0 +\beta_1 x_i + \gamma_0 z_i + e_i
$$ - ì¦‰ ì´ì²˜ëŸ¼ z ë³€ìˆ˜ë¥¼ ì§‘ì–´ë„£ëŠ”ë‹¤.

-ê³ ë“±í•™ê³  ì„±ì ì´ ëŒ€í•™ ì„±ì ì„ ì–¼ë§ˆë‚˜ ì„¤ëª…í•˜ëŠ”ì§€ë¥¼ ë³´ì¸ë‹¤. $$ 
colGPA_i = a + b \times hsGPA_i + e_i
$$

```{r}
str(gpa)
```

```{r}
lm.hsGPA <- lm(colGPA ~ hsGPA, data = gpa)
lm.ACT <- lm(colGPA ~ hsGPA + ACT, data = gpa)
stargazer:: stargazer(lm.hsGPA,
                      lm.ACT,
                      type = "text",
                      keep.stat = c("n", "rsq"))
```

-   í†µì œë³€ìˆ˜ 2\~4ê°œ ì •ë„ ì¶”ê°€í•˜ê³ ,
-   ê·¸ ì´ìœ ì— ëŒ€í•´ì„œ ì„¤ëª…í•´ë³´ì‹œì˜¤.

```{r}
str(gpa)
lm.tst <- lm(colGPA ~ hsGPA + PC + alcohol)
stargazer::stargazer(lm.hsGPA,
                     lm.ACT,
                     lm.tst,
                     type = "text",
                     keep.stat = c("n", "rsq"))
```

## regressionì˜ í™œìš©ë„ì— ëŒ€í•œ...

-   "causuality" -\> ìˆœìˆ˜ ê²½ì œí•™ì€ ì´ ë¬¸ì œë¥¼ ë³´í†µ í‘¼ë‹¤
-   ê·¸ëŸ¬ë‚˜ ìµœê·¼ì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ë¬¸ì œë¥¼ ë§ì´ í‘¼ë‹¤
-   "prediction"
-   "forecasting"

ìš°ì‚° ì‚¬ëŒì˜ ìˆ˜ì™€ ë¹„ê°€ ì˜¬ í™•ë¥ ì€ corr , ê·¸ëŸ¬ë‚˜ ì¸ê³¼ê´€ê³„ë¼ê³  ë³¼ ìˆ˜ëŠ” ì—†ë‹¤. -\> forecasting ì—ì„œëŠ” ì¸ê³¼ê´€ê³„ê°€ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤. ì •ë‹µì„ ê³ ë¥´ëŠ” ê²ƒ ë§Œì´ ëª©ì  -\> ë°˜ëŒ€ë¡œ causualityì˜ ë¬¸ì œë¥¼ ì´ì•¼ê¸° í• ë•ŒëŠ” ë°˜ëŒ€ë¡œ ì—„ê²©í•œ ê¸°ì¤€ì—ì„œ ì¸ê³¼ê´€ê³„ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤

# forecasting ì˜ ë¬¸ì œì— ëŒ€í•œ ì´ì•¼ê¸°

1.  íšŒê·€ëª¨í˜•ì„ ì´ìš©í•œ machine learning

### 1. ëª©ì 

-   machine learningì˜ ëª©ì ì€ prediction ì•„ë˜ì™€ ê°™ì´ ì£¼íƒê°€ê²©ì„ ì˜ˆì¸¡í•˜ëŠ” ëª¨í˜•ì„ ë§Œë“¤ ê²ƒì´ë‹¤.

$$
y_i = \beta_0 + \beta_1 x_i +  \beta_2 x_2i + \cdots + \beta_{ki} + \epsilon_i
$$

### 2. íŒ¨í‚¤ì§€ ì„¤ì¹˜

install.packages("caret") install.packages("MASS")

```{r}
library(caret)
library(MASS)
library(tidyverse)

# data ë•¡ê¸°ê¸°
data("Boston")
head(Boston)
str(Boston)
```

### 3. í¸ì§‘ ë° train

ë³€ìˆ˜ ì„¤ì • - $y$ : ì£¼íƒê°€ê²© - $x$ : ì§€ì—­ í˜¹ì€ ì£¼íƒì˜ íŠ¹ì„±

-   ì—¬ê¸°ì„œëŠ” ì˜ˆì¸¡ì˜ ë¬¸ì œë¥¼ í’€ê¸° ë•Œë¬¸ì— ì¶”ì •í•œë‹¤ê³  í‘œí˜„í•˜ì§€ ì•Šê³  í›ˆë ¨í•œë‹¤ê³  í‘œí˜„í•œë‹¤.
    -   ë˜í•œ ì—¬ê¸°ì„œë¶€í„°ëŠ” ë¨¸ì‹ ëŸ¬ë‹ì˜ ê²°ê³¼ì— ëŒ€í•œ ê²°ê³¼ë¥¼ í•´ì„í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, train data ì™€ test data ë¡œ êµ¬ë¶„í•œë‹¤.
    -   partition ì„ í•˜ê²Œ ë˜ëŠ”ë° ë³´í†µ 3:7 ì •ë„ë¡œ êµ¬ì„±í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.
-   dataë¥¼ train ë°ì´í„°ì™€ test ë°ì´í„°ë¡œ êµ¬ë¶„í•œë‹¤.(partition)

```{r}
set.seed(12345)
library(caret)

traininex<- createDataPartition(Boston$medv,
                           p = 0.8,
                           list = FALSE)
train_data <- Boston[traininex, ]
test_data <- Boston[-traininex, ]

head(train_data)
```

-   ëª¨ë“  features ë¥¼ ì´ìš©í•´ì„œ medv ë¥¼ ì—ì¸¡í•˜ëŠ” ëª¨í˜•ì„ í›ˆë ¨ì‹œí‚¨ë‹¤.

```{r}
lm.all <- lm(medv ~., data = train_data)
summary(lm.all)
```

### 4. ì˜ˆì¸¡

```{r}
prediction <-  predict(lm.all, newdata = test_data)

```

-   ì‹¤ì œ ì§‘ê°’ medv, ëª¨í˜•ì´ ì˜ˆì¸¡í•œ ì§‘ê°’
-   ë‘ë³€ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ìƒˆë¡œìš´ ë°ì´í„° í”„ë˜ì´ë°

```{r}
result <-  data.frame(
  actual = test_data$medv,
  predicted = prediction 
)
str(result)
```

```{r}
theme_set(theme_grey(base_family='NanumGothic'))

result |> 
  ggplot(aes(x = actual, y = predicted )) +
  geom_point() + 
  geom_abline(intercept = 0 , slope = 1, color = "red", linetype = "dashed")
  labs( 
    x = "ì‹¤ì œê°€ê²©", y = "ì˜ˆì¸¡ê°€ê²©"
    )
```

-   ì‹¤ì¸¡ê°’ê³¼ ì˜ˆì¸¡ê°’ ì‚¬ì´ì˜ ê°„ê²©ì„ ìµœì†Œí™” í•˜ê³ ì í•œë‹¤.
-   rmse êµ¬í•˜ëŠ” ê³¼ì •ì¸ ê²ƒ ê°™ìŒ

### 5. ëª¨í˜•ì˜ ì˜ˆì¸¡ì„±ê³¼ì— ëŒ€í•œ í‰ê°€

-   ì„±ëŠ¥, ì í•©ë„, ëª¨ë¸ì˜ ì„¤ì •ì„ í‰ê°€

-   mean squared error $$
    MSE = \frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2
    $$

-   Root mean squared error

$$
RMSE = \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2}
$$ - ë‚´ ì˜ˆì¸¡ì¹˜ì— ëŒ€í•œ MSEì™€ RMSE

```{r}
# MSE
mse <- mean((result$actual - result$predicted)^2)

# RMSE
rmse <- sqrt(mse)

print(paste("MSE:", mse))
print(paste("RMSE:", rmse))

```

-   ê³¼ì í•©ì— ëŒ€í•œ ì„¤ëª…ë„ í•¨. ; ê°„ë‹¨í•˜ê³  ë‹¨ìˆœí•œ ë°©í–¥ìœ¼ë¡œ íšŒê·€ì„ ì„ ê·¸ìœ¼ë¼ëŠ” ê±°ì‹œë‹¤.. ; ëª¨í˜•ì„ ë§‰ ë§‰ ë³µì¡í•˜ê²Œ ë§‰ ë§‰ ë§‰ ë§‰ ê·¸ë ‡ê²Œ ë§‰ ë³€ìˆ˜ë¥¼ ë§‰ ã…‹ã…‹ ì¶”ê°€í•˜ë©´ ë³µì¡í•´ì„œ overfitting ì˜¬ ìˆ˜ë„ ìˆë‹¤ëŠ¥.

### 6. ëª¨ë¸ì„ ê³ ë¥´ëŠ” ê²½ìš°

-íŠ¹ì„±ë³€ìˆ˜ì˜ ì„ íƒ\~ ğŸ¶ğŸ£ğŸ¹ - 3ê°€ì§€ ë°©ë²• (ê³¼ì í•©ì„ í”¼í•˜ê¸° ìœ„í•œ) - forward : í•˜ë‚˜ì”© ë„£ì–´ë³´ê¸° \~ - backward : í•˜ë‚˜ì”© ëº´ë³´ê¸° \~ - both : ë‘˜ë‹¤ ğŸ‘™ - ìµœê·¼ì• ëŠ” ì •ê·œí™”ë¼ëŠ” ë°©ì‹ì„ ìì£¼ ì‚¬ìš©í•œë‹¤.




# 11/27 ìˆ˜ì—…

